Content-Type: multipart/mixed; boundary="MIMEBOUNDARY"
MIME-Version: 1.0

--MIMEBOUNDARY
Content-Disposition: attachment; filename="init.cfg"
Content-Transfer-Encoding: 7bit
Content-Type: text/cloud-config
Mime-Version: 1.0

#cloud-config

write_files:

-   encoding: b64
    content: IyBJTVBPUlRBTlQgTk9URVM6CiMgRW5hYmxlIGFjbCBzc2xfcG9ydHMgb25seSBvbiBwb3J0IDg4LCA0NDMsIDc0NDMsIDk0NDMgYW5kIDg0NDMsIGRlbnkgYWxsIHNzbF9wb3J0cyBub3Qgb24gdGhlIGFjbCBsaXN0LgojIFRoaXMgbWVhbnMgdGhhdCBvbmx5IGFsbG93IGh0dHBzIGFjY2VzcyBvbiBwb3J0IDg4LCA0NDMsIDc0NDMsIDk0NDMgYW5kIDg0NDMuCiMgV2hlbiBibGFja2xpc3RpbmcgYWxsIGRvbWFpbnMgaXMgZW5hYmxlZCwgd2Ugd2lsbCB3aGl0ZWxpc3Qgb25seSB0aGUgbGlzdCBvZiBkb21haW5zIGluIHRoZSB3aGl0ZWxpc3RlZCBkb21haW5zCiMgbGlzdCB2aWEgbG9jYWxuZXQgYW5kIGxvY2FsaG9zdCBjb25uZWN0aXZpdHkuIFdoZW4gYmxhY2tsaXN0aW5nIGlzIGRpc2FibGVkLCB3ZSB3aWxsIGFsbG93IGFsbCBkb21haW5zIHZpYSBsb2NhbG5ldCBhbmQgbG9jYWxob3N0CiMgVGVzdCBTY2VuYXJpbyAxOiBXaGVuIGRvbWFpbiBpcyBub3QgcGFydCBvZiB3aGl0ZWxpc3RlZCBkb21haW4gbGlzdCwgc3F1aWQgd2lsbCByZWplY3QgdGhlIHJlcXVlc3QgdmlhIGBodHRwX2FjY2VzcyBhbGxvdyBsb2NhbG5ldCB3aGl0ZWxpc3RlZF9kb21haW5zYAojIFRlc3QgU2NlbmFyaW8gMjogV2hlbiBkb21haW4gaXMgcGFydCBvZiB3aGl0ZWxpc3RlZCBkb21haW4gbGlzdCBidXQgbm90IHBhcnQgb2YgYWNsIGxvY2FsbmV0IHByaXZhdGUgbmV0d29yaywKIyBzcXVpZCB3aWxsIHJlamVjdCB0aGUgcmVxdWVzdCB2aWEgdGhlIGBodHRwX2FjY2VzcyBkZW55IGFsbGAKIyBDdXJyZW50bHksIHRoZXJlIGlzIG5vIG5lZ2F0aXZlIHRlc3QgdG8gdmVyaWZ5IGEgY29ubmVjdGl2aXR5IGZyb20gbm9uLXdoaXRlbGlzdGVkIGxvY2FsbmV0IG5ldHdvcmsuCgojCiMgUmVjb21tZW5kZWQgbWluaW11bSBjb25maWd1cmF0aW9uOgojCgojIExpc3Qgb2YgYWxsb3dlZCBsb2NhbG5ldCBmcm9tIGludGVybmFsIElQIG5ldHdvcmtzCmFjbCBsb2NhbG5ldCBzcmMgMTAuMC4wLjAvOCAgICAgIyBSRkMxOTE4IHBvc3NpYmxlIGludGVybmFsIG5ldHdvcmsKYWNsIGxvY2FsbmV0IHNyYyAxMDAuNjQuMC4wLzEwICAjIFJGQzY1OTggcG9zc2libGUgaW50ZXJuYWwgbmV0d29yawphY2wgbG9jYWxuZXQgc3JjIDE3Mi4xNi4wLjAvMTIgICMgUkZDMTkxOCBwb3NzaWJsZSBpbnRlcm5hbCBuZXR3b3JrCmFjbCBsb2NhbG5ldCBzcmMgMTkyLjE2OC4wLjAvMTYgIyBSRkMxOTE4IHBvc3NpYmxlIGludGVybmFsIG5ldHdvcmsKCmFjbCBTU0xfcG9ydHMgcG9ydCA4NyAgICAgICAgICAgIyBBbGxvdyBodHRwcyBjb25uZWN0aXZpdHkgb24gdGhpcyBwb3J0CmFjbCBTYWZlX3BvcnRzIHBvcnQgODcgICAgICAgICAgIyBzaW5ncGFzcyB0byBjb21temdhdGUgZm9yIHNtcwoKYWNsIFNTTF9wb3J0cyBwb3J0IDg5ICAgICAgICAgICAjIEFsbG93IGh0dHBzIGNvbm5lY3Rpdml0eSBvbiB0aGlzIHBvcnQKYWNsIFNhZmVfcG9ydHMgcG9ydCA4OSAgICAgICAgICAjIHNpbmdwYXNzIHRvIGNvbW16Z2F0ZSBmb3Igc21zCgphY2wgU1NMX3BvcnRzIHBvcnQgODggICAgICAgICAgICMgQWxsb3cgaHR0cHMgY29ubmVjdGl2aXR5IG9uIHRoaXMgcG9ydAphY2wgU1NMX3BvcnRzIHBvcnQgNDQzICAgICAgICAgICMgQWxsb3cgaHR0cHMgY29ubmVjdGl2aXR5IG9uIHRoaXMgcG9ydAphY2wgU1NMX3BvcnRzIHBvcnQgNzQ0MyAgICAgICAgICMgQWxsb3cgaHR0cHMgY29ubmVjdGl2aXR5IG9uIHRoaXMgcG9ydAphY2wgU1NMX3BvcnRzIHBvcnQgODQ0MyAgICAgICAgICMgQWxsb3cgaHR0cHMgY29ubmVjdGl2aXR5IG9uIHRoaXMgcG9ydAphY2wgU1NMX3BvcnRzIHBvcnQgOTQ0MyAgICAgICAgICMgQWxsb3cgaHR0cHMgY29ubmVjdGl2aXR5IG9uIHRoaXMgcG9ydAoKYWNsIFNhZmVfcG9ydHMgcG9ydCA4MCAgICAgICAgICAjIGh0dHAKYWNsIFNhZmVfcG9ydHMgcG9ydCA0NDMgICAgICAgICAjIGh0dHBzCmFjbCBTYWZlX3BvcnRzIHBvcnQgOTQ0MyAgICAgICAgIyBzaW5ncGFzcyBiYWNrZW5kIG1UTFMgd2l0aCBuZGktY29yZQphY2wgU2FmZV9wb3J0cyBwb3J0IDg4ICAgICAgICAgICMgc2luZ3Bhc3MgdG8gY29tbXpnYXRlIGZvciBzbXMKYWNsIFNhZmVfcG9ydHMgcG9ydCA3NDQzICAgICAgICAjIHNwY3AgdmtleSB0byBzaW5ncGFzcyBtb2JpbGUKYWNsIFNhZmVfcG9ydHMgcG9ydCA4NDQzICAgICAgICAjIHNnc2lnbiBtVExTIHdpdGggbmRpLWNvcmUKYWNsIENPTk5FQ1QgbWV0aG9kIENPTk5FQ1QKCiMKIyBSZWNvbW1lbmRlZCBtaW5pbXVtIEFjY2VzcyBQZXJtaXNzaW9uIGNvbmZpZ3VyYXRpb246CiMKIyBEZW55IHJlcXVlc3RzIHRvIGNlcnRhaW4gdW5zYWZlIHBvcnRzCiMgU2FmZV9wb3J0cyByZWZlcnMgdG8gaHR0cCByZXF1ZXN0LCBhbGxvdyBhbGwgcmVxdWVzdCB0aGF0IGlzIGZyb20gdGhlIGxpc3Qgb2YgU2FmZV9wb3J0cyB3ZSB3aGl0ZWxpc3RlZApodHRwX2FjY2VzcyBkZW55ICFTYWZlX3BvcnRzCgojIERlbnkgQ09OTkVDVCB0byBvdGhlciB0aGFuIHNlY3VyZSBTU0wgcG9ydHMgKDQ0MywgNzQ0MywgODQ0MywgOTQ0MykKIyBDT05ORUNUIG1ldGhvZCBzdGFydHMgdHdvLXdheSBjb21tdW5pY2F0aW9ucyB3aXRoIHRoZSByZXF1ZXN0ZWQgcmVzb3VyY2UgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSFRUUC9NZXRob2RzL0NPTk5FQ1QKIyBTU0xfcG9ydHMgcmVmZXJzIHRvIGh0dHBzIHJlcXVlc3QsIGFsbG93IGFsbCBodHRwcyByZXF1ZXN0IHRoYXQgaXMgZnJvbSB0aGUgYWNsIGxpc3Qgb2YgU1NMX3BvcnRzIHdlIHdoaXRlbGlzdGVkCmh0dHBfYWNjZXNzIGRlbnkgQ09OTkVDVCAhU1NMX3BvcnRzCgojIFdlIHN0cm9uZ2x5IHJlY29tbWVuZCB0aGUgZm9sbG93aW5nIGJlIHVuY29tbWVudGVkIHRvIHByb3RlY3QgaW5ub2NlbnQKIyB3ZWIgYXBwbGljYXRpb25zIHJ1bm5pbmcgb24gdGhlIHByb3h5IHNlcnZlciB3aG8gdGhpbmsgdGhlIG9ubHkKIyBvbmUgd2hvIGNhbiBhY2Nlc3Mgc2VydmljZXMgb24gImxvY2FsaG9zdCIgaXMgYSBsb2NhbCB1c2VyCmh0dHBfYWNjZXNzIGRlbnkgdG9fbG9jYWxob3N0CgojCiMgSU5TRVJUIFlPVVIgT1dOIFJVTEUoUykgSEVSRSBUTyBBTExPVyBBQ0NFU1MgRlJPTSBZT1VSIENMSUVOVFMKIwoKIyBJZiB3aGl0ZWxpc3RlZCBkb21haW5zIGFyZSBzcGVjaWZpZWQsIG9ubHkgYWxsb3cgdGhvc2UgZnJvbSBsb2NhbG5ldCBhbmQgbG9jYWxob3N0CiMgRWxzZSwgd2UgYWxsb3cgYWxsIGRvbWFpbnMgZnJvbSBsb2NhbG5ldCBhbmQgbG9jYWxob3N0Cmh0dHBfYWNjZXNzIGFsbG93IGxvY2FsbmV0Cmh0dHBfYWNjZXNzIGFsbG93IGxvY2FsaG9zdAoKIyBBbmQgZmluYWxseSBkZW55IGFsbCBvdGhlciBhY2Nlc3MgdG8gdGhpcyBwcm94eQpodHRwX2FjY2VzcyBkZW55IGFsbAoKIyBTcXVpZCBub3JtYWxseSBsaXN0ZW5zIHRvIHBvcnQgMzEyOApodHRwX3BvcnQgMzEyOAoKIyBMZWF2ZSBjb3JlZHVtcHMgaW4gdGhlIGZpcnN0IGNhY2hlIGRpcgpjb3JlZHVtcF9kaXIgL3Zhci9zcG9vbC9zcXVpZAoKIyBBZGp1c3QgTG9nIExldmVscyBmb3IgRGVidWdnaW5nCiMgaHR0cHM6Ly93aWtpLnNxdWlkLWNhY2hlLm9yZy9Lbm93bGVkZ2VCYXNlL0RlYnVnU2VjdGlvbnMKZGVidWdfb3B0aW9ucyBBTEwsMQo=
    owner: root:squid
    path: /etc/squid/squid.conf
    permissions: '0644'

-   encoding: b64
    content: PHNvdXJjZT4KICBAdHlwZSB0YWlsCiAgcGF0aCAiL3Zhci9sb2cvYmFzaF9oaXN0b3J5X2VuaGFuY2VkIgogIHBvc19maWxlICIvdmFyL2xvZy90ZC1hZ2VudC9iYXNoX2hpc3RvcnlfZW5oYW5jZWQucG9zIgogIHRhZyAiYmFzaF9oaXN0b3J5IgogIDxwYXJzZT4KICAgICAgQHR5cGUgbm9uZQogIDwvcGFyc2U+Cjwvc291cmNlPgoKPHNvdXJjZT4KICBAdHlwZSB1ZHAKICBwb3J0IDUxNDAKICBiaW5kIDEyNy4wLjAuMQogIHRhZyAic3lzbG9nIgogIDxwYXJzZT4KICAgIEB0eXBlIG5vbmUKICAgIG1lc3NhZ2Vfa2V5IGxvZwogIDwvcGFyc2U+Cjwvc291cmNlPgoKPGZpbHRlciBzeXNsb2cuKio+CiAgQHR5cGUgcGFyc2VyCiAga2V5X25hbWUgbG9nCiAgPHBhcnNlPgogICAgQHR5cGUgc3lzbG9nCiAgICBtZXNzYWdlX2Zvcm1hdCBhdXRvCiAgICB3aXRoX3ByaW9yaXR5IHRydWUKICA8L3BhcnNlPgogIHJlc2VydmVfZGF0YSB0cnVlCjwvZmlsdGVyPgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyBTcGxpdCBzeXNsb2cgc291cmNlcwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKPG1hdGNoIHN5c2xvZy4qKj4KICBAdHlwZSByZXdyaXRlX3RhZ19maWx0ZXIKICA8cnVsZT4KICAgIGtleSBpZGVudAogICAgcGF0dGVybiAvXmF1ZGlzcGQkLwogICAgdGFnIG9zLmF1ZGl0CiAgPC9ydWxlPgogIDxydWxlPgogICAga2V5IGlkZW50CiAgICBwYXR0ZXJuIC8uKy8KICAgIHRhZyBvcy5zZWN1cmUKICA8L3J1bGU+CjwvbWF0Y2g+CgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyBPUyBMb2dzIHRvIENlbnRyYWwoanNvbikgYW5kIFNJRU0gKHJhdykKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgo8bWF0Y2ggb3MuKio+CiAgQHR5cGUgcm91dGUKICA8cm91dGUgKio+CiAgICBhZGRfdGFnX3ByZWZpeCBjZW50cmFsCiAgICBjb3B5CiAgPC9yb3V0ZT4KICA8cm91dGUgKio+CiAgICBhZGRfdGFnX3ByZWZpeCBjdy1zaWVtCiAgICBjb3B5CiAgPC9yb3V0ZT4KPC9tYXRjaD4KCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMgU3F1aWQgTG9ncyB0byBDZW50cmFsIGFuZCBTSUVNIChqc29uKQojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgo8c291cmNlPgogIEB0eXBlIHRhaWwKICBwYXRoICIvdmFyL2xvZy9zcXVpZC9hY2Nlc3MubG9nIgogIHBvc19maWxlICIvdmFyL2xvZy90ZC1hZ2VudC9zcXVpZC5hY2Nlc3MucG9zIgogIHRhZyAic3F1aWQuYWNjZXNzIgogIDxwYXJzZT4KICAgIEB0eXBlIG5vbmUKICA8L3BhcnNlPgo8L3NvdXJjZT4KCjxzb3VyY2U+CiAgQHR5cGUgdGFpbAogIHBhdGggIi92YXIvbG9nL3NxdWlkL2NhY2hlLmxvZyIKICBwb3NfZmlsZSAiL3Zhci9sb2cvdGQtYWdlbnQvc3F1aWQuY2FjaGUucG9zIgogIHRhZyAic3F1aWQuY2FjaGUiCiAgPHBhcnNlPgogICAgQHR5cGUgbm9uZQogIDwvcGFyc2U+Cjwvc291cmNlPgoKPG1hdGNoIHNxdWlkLioqPgogIEB0eXBlIHJvdXRlCiAgPHJvdXRlICoqPgogICAgYWRkX3RhZ19wcmVmaXggY2VudHJhbAogICAgY29weQogIDwvcm91dGU+CiAgPHJvdXRlICoqPgogICAgYWRkX3RhZ19wcmVmaXggY3ctc2llbS1qc29uCiAgICBjb3B5CiAgPC9yb3V0ZT4KPC9tYXRjaD4KPGZpbHRlciBjZW50cmFsLnNxdWlkLmFjY2Vzcz4KICBAdHlwZSBwYXJzZXIKICBrZXlfbmFtZSBtZXNzYWdlCiAgPHBhcnNlPgogICAgQHR5cGUgcmVnZXhwCiAgICBleHByZXNzaW9uIC9cZCtcLlxkK1xzKyg/PGR1cmF0aW9uPlxkKylccysoPzxzcmM+W15cc10rKVxzKD88Y29kZT5bXlxzXSspXC8oPzxzdGF0dXM+XGQrKVxzKyg/PGJ5dGVzX2luPlxkKylccysoPzxodHRwX21ldGhvZD5bXlxzXSspXHMrKD88dXJsPlteXHNdKylccysoPzx1c2VyPlteXHNdKylccysoPzxoaWVyYXJjaHlfY29kZT5bXlwvXSspXC8oPzxkZXN0PlteXHNdKylccysoPzxodHRwX2NvbnRlbnRfdHlwZT4uKikvCiAgPC9wYXJzZT4KPC9maWx0ZXI+CiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIE90aGVyIExvZ3MgdG8gQ2VudHJhbAojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCjxzb3VyY2U+CiAgQHR5cGUgdGFpbAogIHBhdGggIi92YXIvbG9nL2Nsb3VkLWluaXQubG9nIgogIHBvc19maWxlICIvdmFyL2xvZy90ZC1hZ2VudC9jbG91ZC1pbml0LnBvcyIKICB0YWcgImNlbnRyYWwuY2xvdWRpbml0IgogIDxwYXJzZT4KICAgICAgQHR5cGUgbm9uZQogIDwvcGFyc2U+Cjwvc291cmNlPgoKPHNvdXJjZT4KICBAdHlwZSB0YWlsCiAgcGF0aCAiL3Zhci9sb2cvdXNlci1kYXRhLmxvZyIKICBwb3NfZmlsZSAiL3Zhci9sb2cvdGQtYWdlbnQvdXNlci1kYXRhLnBvcyIKICB0YWcgImNlbnRyYWwudXNlcmRhdGEiCiAgPHBhcnNlPgogICAgQHR5cGUgbm9uZQogIDwvcGFyc2U+Cjwvc291cmNlPgoKPHNvdXJjZT4KICBAdHlwZSBzeXN0ZW1kCiAgdGFnICJjZW50cmFsLnN5c3RlbWQiCiAgcGF0aCAvcnVuL2xvZy9qb3VybmFsCiAgbWF0Y2hlcyBbXQogIHJlYWRfZnJvbV9oZWFkIHRydWUKCiAgPHN0b3JhZ2U+CiAgICBAdHlwZSBsb2NhbAogICAgcGF0aCAvdmFyL2xvZy90ZC1hZ2VudC9mbHVlbnRkLWpvdXJuYWxkLWN1cnNvci5qc29uCiAgPC9zdG9yYWdlPgoKICA8ZW50cnk+CiAgICBmaWVsZHNfc3RyaXBfdW5kZXJzY29yZXMgdHJ1ZQogICAgZmllbGRzX2xvd2VyY2FzZSB0cnVlCiAgPC9lbnRyeT4KPC9zb3VyY2U+CgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMgU3RhbXAgZXNfaW5kZXgsIGdyb3VwX25hbWUgYW5kIHN0cmVhbV9uYW1lCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCjxmaWx0ZXIgY2VudHJhbC4qKj4KICBAdHlwZSByZWNvcmRfdHJhbnNmb3JtZXIKICBlbmFibGVfcnVieSB0cnVlCiAgPHJlY29yZD4KICAgIGVzX2luZGV4ICAgICAgICAiZG16LWZwLSR7dGltZS5zdHJmdGltZSgnJVkuJW0nKX0iCiAgICBncm91cF9uYW1lICAgICAgIm5kaS1pcWEtZG16IgogICAgc3RyZWFtX25hbWUgICAgICIje1NvY2tldC5nZXRob3N0bmFtZX0iCiAgPC9yZWNvcmQ+CjwvZmlsdGVyPgoKPGZpbHRlciBjdy1zaWVtLm9zLioqPgogIEB0eXBlIHJlY29yZF90cmFuc2Zvcm1lcgogIGVuYWJsZV9ydWJ5IHRydWUKICA8cmVjb3JkPgogICAgZ3JvdXBfbmFtZSAgICAgICJuZGktaXFhL29zIgogICAgc3RyZWFtX25hbWUgICAgICIje1NvY2tldC5nZXRob3N0bmFtZX0iCiAgPC9yZWNvcmQ+CjwvZmlsdGVyPgoKPGZpbHRlciBjdy1zaWVtLWpzb24uc3F1aWQuKio+CiAgQHR5cGUgcmVjb3JkX3RyYW5zZm9ybWVyCiAgZW5hYmxlX3J1YnkgdHJ1ZQogIDxyZWNvcmQ+CiAgICBncm91cF9uYW1lICAgICAgIm5kaS1pcWEvc3F1aWQiCiAgICBzdHJlYW1fbmFtZSAgICAgIiN7U29ja2V0LmdldGhvc3RuYW1lfSIKICA8L3JlY29yZD4KPC9maWx0ZXI+CgojIEFkZGluZyBzeXNsb2dfbWVzc2FnZSBhcyBhIHJlY29yZCBrZXkgaGVyZSB0byBtYXRjaCB0aGUgY29uZmlndXJhdGlvbiB1bmRlciA8bWF0Y2ggY3ctc3lzbG9nLioqPiBibG9jayBpbiBuZGktY29yZS1zZXJ2aWNlLWRlcGxveS9hcG0vbmRpLWZsdWVudGQtYWdncmVnYXRvci92YWx1ZXMueWFtbC4KIyBUaGUgaW50ZW50aW9uIGlzIG5vdCB0byBvdXRwdXQgdGhlIGJhc2ggaGlzdG9yeSBhcyBzeXNsb2cgYnV0IGFzIGEgd29ya2Fyb3VuZCB0byBvdXRwdXQganVzdCB0aGUgdmFsdWUgZnJvbSB0aGUgcmVjb3JkWyJtZXNzYWdlIl0sIGluc3RlYWQgb2YgdGhlIHdob2xlIHJlY29yZCBhcyBqc29uLgo8ZmlsdGVyIGJhc2hfaGlzdG9yeT4KICBAdHlwZSByZWNvcmRfdHJhbnNmb3JtZXIKICBlbmFibGVfcnVieSB0cnVlCiAgPHJlY29yZD4KICAgIGdyb3VwX25hbWUgICAgICAibmRpLWlxYS9iYXNoLWhpc3RvcnkiCiAgICBzdHJlYW1fbmFtZSAgICAgIiN7U29ja2V0LmdldGhvc3RuYW1lfSIKICAgIHN5c2xvZ19tZXNzYWdlICAgJHtyZWNvcmRbIm1lc3NhZ2UiXX0KICA8L3JlY29yZD4KPC9maWx0ZXI+CgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMgU2VuZCBhbGwgbG9ncyB0byBMb2cgQWdncmVnYXRvcgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgo8bWF0Y2ggKio+CiAgQHR5cGUgZm9yd2FyZAogIDxzZXJ2ZXI+CiAgICBob3N0IGxvZ3MubWdtdC5hYWRzLm5kaQogICAgcG9ydCAzMDUxNgogIDwvc2VydmVyPgoKICA8YnVmZmVyPgogICAgQHR5cGUgZmlsZQogICAgcGF0aCAvdmFyL2xvZy90ZC1hZ2VudC9mb3J3YXJkLmJ1ZmZlcgogICAgZmx1c2hfbW9kZSBpbnRlcnZhbAogICAgcmV0cnlfdHlwZSBleHBvbmVudGlhbF9iYWNrb2ZmCiAgICBmbHVzaF90aHJlYWRfY291bnQgOAogICAgZmx1c2hfaW50ZXJ2YWwgNXMKICAgIHJldHJ5X21heF9pbnRlcnZhbCAzMAogICAgcmV0cnlfZm9yZXZlciB0cnVlCiAgICBjaHVua19saW1pdF9zaXplIDhNCiAgICBvdmVyZmxvd19hY3Rpb24gYmxvY2sKICA8L2J1ZmZlcj4KPC9tYXRjaD4KCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMgU2VuZCB0ZC1hZ2VudCBsb2cgdG8gTG9nIEFnZ3JlZ2F0b3IKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCjxsYWJlbCBARkxVRU5UX0xPRz4KICA8ZmlsdGVyIGZsdWVudC4qKj4KICAgIEB0eXBlIHJlY29yZF90cmFuc2Zvcm1lcgogICAgZW5hYmxlX3J1YnkgdHJ1ZQogICAgPHJlY29yZD4KICAgICAgZXNfaW5kZXggICAgICAgICJkbXotZnAtJHt0aW1lLnN0cmZ0aW1lKCclWS4lbScpfSIKICAgICAgZ3JvdXBfbmFtZSAgICAgICJuZGktaXFhLWRteiIKICAgICAgc3RyZWFtX25hbWUgICAgICIje1NvY2tldC5nZXRob3N0bmFtZX0iCiAgICA8L3JlY29yZD4KICA8L2ZpbHRlcj4KCiAgPG1hdGNoIGZsdWVudC4qKj4KICAgIEBpZCBmb3J3YXJkX2ZsdWVudGQKICAgIEB0eXBlIGZvcndhcmQKICAgIDxzZXJ2ZXI+CiAgICAgIGhvc3QgbG9ncy5tZ210LmFhZHMubmRpCiAgICAgIHBvcnQgMzA1MTYKICAgIDwvc2VydmVyPgoKICAgIDxidWZmZXI+CiAgICAgIEB0eXBlIGZpbGUKICAgICAgcGF0aCAvdmFyL2xvZy90ZC1hZ2VudC9mbHVlbnRkLmJ1ZmZlcgogICAgICBmbHVzaF9tb2RlIGludGVydmFsCiAgICAgIHJldHJ5X3R5cGUgZXhwb25lbnRpYWxfYmFja29mZgogICAgICBmbHVzaF90aHJlYWRfY291bnQgMgogICAgICBmbHVzaF9pbnRlcnZhbCA1cwogICAgICByZXRyeV9tYXhfaW50ZXJ2YWwgMzAKICAgICAgcmV0cnlfZm9yZXZlciB0cnVlCiAgICAgIGNodW5rX2xpbWl0X3NpemUgOE0KICAgICAgb3ZlcmZsb3dfYWN0aW9uIGJsb2NrCiAgICA8L2J1ZmZlcj4KICA8L21hdGNoPgo8L2xhYmVsPg==
    owner: td-agent:td-agent
    path: /etc/td-agent/td-agent.conf
    permissions: '0644'

-   encoding: b64
    content: IyBUaGlzIGZpbGUgY29udHJvbHMgdGhlIGNvbmZpZ3VyYXRpb24gb2YgdGhlIHN5c2xvZyBwbHVnaW4uCiMgSXQgc2ltcGx5IHRha2VzIGV2ZW50cyBhbmQgd3JpdGVzIHRoZW0gdG8gc3lzbG9nLiBUaGUKIyBhcmd1bWVudHMgcHJvdmlkZWQgY2FuIGJlIHRoZSBkZWZhdWx0IHByaW9yaXR5IHRoYXQgeW91CiMgd2FudCB0aGUgZXZlbnRzIHdyaXR0ZW4gd2l0aC4gQW5kIG9wdGlvbmFsbHksIHlvdSBjYW4gZ2l2ZQojIGEgc2Vjb25kIGFyZ3VtZW50IGluZGljYXRpbmcgdGhlIGZhY2lsaXR5IHRoYXQgeW91IHdhbnQgZXZlbnRzCiMgbG9nZ2VkIHRvLiBWYWxpZCBvcHRpb25zIGFyZSBMT0dfTE9DQUwwIHRocm91Z2ggNywgTE9HX0FVVEgsCiMgTE9HX0FVVEhQUklWLCBMT0dfREFFTU9OLCBMT0dfU1lTTE9HLCBhbmQgTE9HX1VTRVIuCgphY3RpdmUgPSB5ZXMKZGlyZWN0aW9uID0gb3V0CnBhdGggPSBidWlsdGluX3N5c2xvZwp0eXBlID0gYnVpbHRpbgphcmdzID0gTE9HX0xPQ0FMNgpmb3JtYXQgPSBzdHJpbmc=
    owner: root:root
    path: /etc/audisp/plugins.d/syslog.conf
    permissions: '0644'


--MIMEBOUNDARY
Content-Transfer-Encoding: 7bit
Content-Type: text/x-shellscript
Mime-Version: 1.0

#!/usr/bin/env bash

set -euxo pipefail

# Configure log files for td-agent to pick up
chmod 0644 /var/log/cloud-init.log

# Clean up after NDI-2179?
# Not required after we moved to syslog
chmod -R 0755 /var/log/audit
chmod 0605 /var/log/secure

echo "Starting td-agent service.."
systemctl enable td-agent
systemctl start td-agent
echo "Successfully started td-agent!"

--MIMEBOUNDARY
Content-Transfer-Encoding: 7bit
Content-Type: text/x-shellscript
Mime-Version: 1.0

#!/usr/bin/env bash

set -euxo pipefail

# Configure rsyslog to pick up logs to fluentd
cat >> /etc/rsyslog.conf << EOF

# Send secure logs and audit logs to fluentd
authpriv.* @127.0.0.1:5140
local6.*   @127.0.0.1:5140
EOF

echo "Restarting syslog services.."
service auditd restart
systemctl restart rsyslog
echo "Successfully restarted syslog services!"
--MIMEBOUNDARY
Content-Transfer-Encoding: 7bit
Content-Type: text/x-shellscript
Mime-Version: 1.0

#!/usr/bin/env bash

set -euxo pipefail

echo "Starting squid service..."
systemctl enable squid
systemctl start squid
echo "Successfully started squid!"

--MIMEBOUNDARY
Content-Transfer-Encoding: 7bit
Content-Type: text/x-shellscript
Mime-Version: 1.0

#!/usr/bin/env bash
set -eu

/opt/ds_agent/dsa_control -r
/opt/ds_agent/dsa_control -a "dsm://mgmt.epp.aads.ndi:4120/" "policy:ndi-linux"
--MIMEBOUNDARY
Content-Transfer-Encoding: 7bit
Content-Type: text/x-shellscript
Mime-Version: 1.0

#!/bin/bash

set -euo pipefail

echo "Set aws region"
/usr/local/bin/aws configure set default.region ap-southeast-1

echo "Fetching certs for config file..."

sensor_certs_and_key=$(/usr/local/bin/aws secretsmanager get-secret-value \
  --secret-id  "ndi-iqa-edr-server/sensor-certs-and-key" \
  --version-stage "AWSCURRENT" \
  --output text \
  --query SecretString)

sudo echo "$sensor_certs_and_key" >> /var/opt/carbonblack/response/sensorsettings.ini

echo "Appending to sensorsettings.ini..."

sudo cat << EOF >> /var/opt/carbonblack/response/sensorsettings.ini
ConfigName=Default+Group
SensorBackendServer=https%3A%2F%2Fedr.mgmt.ndi.gov.sg
EOF

echo "Starting EDR agent service..."
sudo systemctl enable cbdaemon
sudo systemctl restart cbdaemon
--MIMEBOUNDARY--
